<div class="container-fluid overflow-hidden">
  <div class="row">
    <!-- Left Panel: Active Users -->
    <div class="col-md-2 col-sm-12 bg-light border-end d-flex flex-column p-3">
      <div class="text-center fs-2">
        <img
          src="https://skribbl.io/img/clock.gif"
          alt=""
          srcset=""
          style="width: 35px; height: 35px"
        />
        {{ groupTimer }}
      </div>

      <h5 class="text-center mb-3">Active Users</h5>
      <div *ngIf="!isStarted" class="flex-grow-1 overflow-auto px-3 py-2">
        <div
          *ngFor="let item of activeUsers"
          class="card mb-2 shadow-sm border-0"
          [ngClass]="{
            'bg-light': item !== user,
            'bg-info bg-opacity-25': item === user
          }"
        >
          <div
            class="card-body d-flex align-items-center justify-content-between py-2 px-3"
          >
            <div class="d-flex align-items-center gap-2">
              <img
                src="https://skribbl.io/img/setting_1.gif"
                class="rounded-circle"
                style="width: 30px; height: 30px"
                alt="avatar"
              />
              <div>
                <strong
                  [ngClass]="{
                    'text-primary': item === user,
                    'text-dark': item !== user
                  }"
                >
                  {{ item }}
                </strong>
                <div *ngIf="CreatedBy != item" class="small text-muted">Waiting to start...</div>
                <div *ngIf="CreatedBy == item" class="small text-muted"><b>Owner</b></div>
              </div>
            </div>

            <div class="d-flex align-items-center gap-1">
              <img
                *ngIf="CreatedBy === item"
                src="https://skribbl.io/img/owner.gif"
                title="Room Owner"
                style="width: 24px; height: 24px"
              />
              <img
                *ngIf="whoDraw === item"
                src="https://skribbl.io/img/pen.gif"
                title="Drawing"
                style="width: 24px; height: 24px"
              />
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="isStarted" class="flex-grow-1 overflow-auto px-3 py-2">
        <div
          *ngFor="let item of groupPoints"
          class="card mb-2 shadow-sm border-0"
          [ngClass]="{
            'bg-light': item.user !== user ,
            'bg-info bg-opacity-25': item.user === user,
            'bg-success' : isUserGuess ,
          }"
        >
          <div
            class="card-body d-flex align-items-center justify-content-between py-2 px-3"
          >
            <div class="d-flex align-items-center gap-2">
              <img
                src="https://skribbl.io/img/setting_1.gif"
                class="rounded-circle"
                style="width: 30px; height: 30px"
                alt="avatar"
              />
              <div>
                <strong
                  [ngClass]="{
                    'text-primary': item.user === user,
                    'text-dark': item.user !== user
                  }"
                >
                  {{ item.user }}
                </strong>
                <div class="small text-muted">{{ item.points }} pts</div>
              </div>
            </div>

            <div class="d-flex align-items-center gap-1">
              <img
                *ngIf="CreatedBy === item.user"
                src="https://skribbl.io/img/owner.gif"
                title="Room Owner"
                style="width: 24px; height: 24px"
              />
              <img
                *ngIf="whoDraw === item.user"
                src="https://skribbl.io/img/pen.gif"
                title="Drawing"
                style="width: 24px; height: 24px"
              />
            </div>
          </div>
        </div>
      </div>

      
    </div>

    <!-- Center Panel: Canvas -->
    <div class="col-md-7 canvas-wrapper col-sm-12 d-flex flex-column p-3">
      <div class="fs-3 text-center">Round {{ round }} of {{ totalRound }}</div>

      <div class="text-center" *ngIf="!isStarted && user == CreatedBy">
        Start a game with {{ activeUsers.length }} users :
        <button class="btn btn-outline-secondary w-10" (click)="start()">
          Play
        </button>
        <button class="btn   " (click)="start()">
          <img src="https://skribbl.io/img/settings.gif" title="Setting" style="width: 25px; height: 25px">
        </button>

      </div>
      <div class="flex-grow-1 border rounded shadow-sm mb-3">
        <div *ngIf="isStarted" class="text-center fs-3">
          {{ userSelectedWord }}
        </div>
        <div *ngIf="whoDraw != user && isStarted" class="text-center fs-3">
          <span *ngFor="let _ of [].constructor(guessWordLength)">_ </span>
          {{ guessWordLength }}
        </div>
        <ng-whiteboard
          (mouseup)="send()"
          (touchend)="send()"
          style="height: 96%; width: 100%"
          class="whiteboard-box"
          [center]="true"
          (dataChange)="onDataChange($event)"
          [drawingEnabled]="whoDraw == user ? true : false"
          [options]="whiteboardOptions"
        >
        </ng-whiteboard>
      </div>

      <!-- Controls Below Canvas -->
      <div class="d-flex justify-content-between">
        <button
          class="btn btn-outline-secondary w-100 w-sm-auto me-0 me-sm-2 mb-2 mb-sm-0"
          [disabled]="whoDraw != user"
          (click)="Undo()"
        >
          Undo
          <img
            src="https://skribbl.io/img/undo.gif"
            style="width: 35px; height: 35px"
          />
        </button>
        <button
          class="btn btn-outline-secondary w-100 w-sm-auto me-0 me-sm-2 mb-2 mb-sm-0"
          [disabled]="whoDraw != user"
          (click)="clearBoard()"
        >
          Clear
          <img
            src="https://skribbl.io/img/clear.gif"
            style="width: 35px; height: 35px"
          />
        </button>
        <!-- <button
          class="btn btn-primary w-100 w-sm-auto"
          [disabled]="whoDraw != user"
          (click)="send()"
        >
          Send Canvas
        </button> -->
      </div>
    </div>
    <!-- Right Panel: Chat -->
    <div
      class="col-md-3 col-sm-12 d-flex flex-column bg-white border-start p-3 chat-container"
    >
      <!-- Chat Header -->
      <div
        class="text-center bg-primary text-white rounded py-2 mb-3 shadow-sm"
      >
        <strong>{{ naam }}</strong>
      </div>

      <!-- Chat Messages: Scrollable -->
      <div
        #chatContainer
        class="flex-grow-1 overflow-auto mb-3"
        style="min-height: 0"
      >
        <div
          *ngFor="let msg of chats"
          class="d-flex mb-2"
          [ngClass]="
            msg.sender === user
              ? 'justify-content-end'
              : 'justify-content-start'
          "
        >
          <div
            class="p-2 rounded shadow-sm message-bubble"
            [ngClass]="
              msg.sender === user
                ? 'bg-primary text-white'
                : 'bg-secondary text-white'
            "
            style="max-width: 75%"
          >
            <div class="fw-bold small">{{ msg.sender }}</div>
            <div>{{ msg.message }}</div>
            <div class="text-end small text-light">
              {{ msg.sentAt | date : "MMM d, y, h:mm a" }}
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Input (Fixed at Bottom) -->
      <div class="d-flex chat-input">
        <input
          type="text"
          class="form-control mb-2 mb-sm-0"
          [disabled]="whoDraw == user || isUserGuess"
          placeholder="Type a message..."
          [(ngModel)]="message"
          (keydown.enter)="sendchat()"
        />
        <button
          class="btn btn-success ms-sm-2 w-100 w-sm-auto"
          [disabled]="whoDraw == user || isUserGuess"
          (click)="sendchat()"
        >
          Send
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade show d-block"
  *ngIf="showWordSelectionModal"
  id="staticBackdrop"
  tabindex="-1"
  style="background: rgba(0, 0, 0, 0.5)"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">Choose a Word to Draw</h1>
      </div>
      <div class="modal-body">
        <div class="d-flex flex-column gap-2">
          <button
            *ngFor="let item of selectedRandomWords"
            class="btn btn-outline-primary"
            (click)="selectedRandomWord(item)"
          >
            {{ item }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Winner Modal -->
<div
  class="modal fade show d-block"
  *ngIf="winnerModalVisible"
  tabindex="-1"
  style="background: rgba(0, 0, 0, 0.7); z-index: 1055"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content text-center border-0 shadow-lg rounded-4">
      <div class="modal-header bg-gradient-success text-white rounded-top-4">
        <h5
          class="modal-title text-dark w-100 d-flex align-items-center justify-content-center"
        >
          üéâ Game Over!
          <img
            src="https://skribbl.io/img/trophy.gif"
            class="ms-2"
            style="width: 40px; height: 40px"
          />
        </h5>
      </div>
      <div class="modal-body px-5 py-4">
        <h4 class="mb-4 text-warning fw-bold">üèÜ Top 3 Players</h4>
        <div class="row justify-content-center">
          <div
            class="col-md-4 mb-3"
            *ngFor="let player of winner; let i = index"
          >
            <div
              class="card border-0 shadow h-100"
              [ngClass]="{
                'bg-warning bg-opacity-75': i === 0,
                'bg-secondary bg-opacity-50': i === 1,
                'bg-bronze bg-opacity-50': i === 2
              }"
            >
              <div class="card-body">
                <div class="display-5 mb-2">
                  <span *ngIf="i === 0">ü•á</span>
                  <span *ngIf="i === 1">ü•à</span>
                  <span *ngIf="i === 2">ü•â</span>
                </div>
                <h5 class="card-title fw-bold text-dark">{{ player.user }}</h5>
                <p class="card-text fs-4">Points: {{ player.points }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button
          class="btn btn-outline-success px-4 fw-semibold"
          (click)="restartGame()"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
